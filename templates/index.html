{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Partners for your mountain outings" %} | {{ block.super }}{% endblock %}

{% block index %}
<div class="d-flex align-items-center" style="min-height: calc(100% - 60px); min-width: 100%; background: url('/static/img/bg_1.JPG') no-repeat; background-size: cover; z-index: 10; background-attachment: fixed;">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xl-2 order-1">
            </div>
            <div class="col-xl-2 order-3">
            </div>
            <div class="col-xl-8 order-2">
                <div class="col-md-6 col-xl-6">
                    <div class="card" style="background-color: rgba(225,225,225,0.9);">
                        <div class="card-body text-center">
                            <h1 class="card-text h4 p-4">{% trans "Find partners for your outings in the mountain." %}</h1>
                            <form type="GET" action="{% url 'profiles:search' %}">
                                <div class="form-row">
                                    <div class="form-group col-12">
                                        <ul id="id_activities" class="custom-form-check-inline">
                                            {% for activity in all_activities %}
                                            <li><label for="id_activities_{{ activity }}"><input type="checkbox" name="a" value="{{ activity }}" class="custom-form-check-inline" id="id_activities_{{ activity }}">{{ activity }}</label></li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    <div class="form-group col-12">
                                        <button class="btn btn-outline-success btn-block text-uppercase" type="submit">{% trans "Search Profile" %}</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid bg-light">
    <div class="row pt-5 pb-3 px-md-5 px-xl-0">
        <div class="col-xl-2 order-1">
        </div>
        <div class="col-xl-2 order-3">
        </div>
        <div class="col-xl-8 order-2">
            <div class="row">
                <div class="col-12 col-md-6 col-xl-4">
                    <h3>{% trans 'For whom?' %}</h3>
                    <p>{% trans 'Sportsmen and sportswomen struggling to find partners to explore the outdoors. Especially the mountains.' %}</p>
                </div>
                <div class="col-12 col-md-6 col-xl-4">
                    <h3>{% trans 'What for?' %}</h3>
                    <p>{% trans 'Find partners that match your activities, your level and your aspirations.' %}</p>
                </div>
                <div class="col-12 col-md-12 col-xl-4">
                    <h3>{% trans 'How it works?' %}</h3>
                    <ul class="list-unstyled">
                        <li class="mb-2">{% trans 'Watch profiles and outings. Contact directly the ones fitting your interest.' %}</li>
                        <li>{% trans 'Publish your own profile or outings to be contacted by potential partners.' %}</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid bg-white">
    <div class="row pt-5 pb-3 px-md-5 px-xl-0">
        <div class="col-xl-2 order-1">
        </div>
        <div class="col-xl-2 order-3">
        </div>
        <div class="col-xl-8 order-2">
            <div class="row">
                <div class="col-12 pb-3">
                    <h2>{% trans 'Last profiles created' %}</h2>
                </div>
                {% for profile in 5_last_profiles %}
                    <div class="col-sm-6 col-lg-4 mb-4">
                        <div class="card" onclick="document.location='{{ profile.get_absolute_url }}'" style="cursor: pointer;">
                            <div class="card-body">
                                <div class="row align-items-start">
                                    <div class="col-3 mb-2">
                                        {% if profile.profile_picture %}
                                        <img src="{{ profile.profile_picture.url }}" class="img-fluid" alt="Profile picture">
                                        {% else %}
                                        <img src="{% static 'img/icon_user.png' %}" class="img-fluid img-thumbnail" alt="Default profile picture">
                                        {% endif %}
                                    </div>
                                    <div class="col-9">
                                        <h5><a href="{{ profile.get_absolute_url }}">{% include "profiles/snippets/username.html" %}</a></h5>
                                        <p class="card-text">
                                            <span class="font-weight-bold">{{ profile.availability_area }}</span>
                                            {% if profile.age %}<br>{% blocktrans with profile_age=profile.age %}{{ profile_age }} years{% endblocktrans %}{% endif %}
                                        </p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <p class="card-text">
                                            {% for activity in profile.activities.all %}
                                                <span class="badge badge-pill badge-info mb-1">{{ activity.name }}</span>
                                            {% endfor %}<br>
                                            {{ profile.introduction|truncatechars:200 }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                {% if user.is_anonymous %}
                    <div class="col-sm-6 col-lg-4 mb-4">
                        <div class="card bg-success" style="height: 100%;">
                            <div class="card-body d-flex align-items-center justify-content-center">
                                <p class="card-title text-uppercase align-middle mb-0 h4 text-center"><a href="{% url 'profile_register' %}" class="stretched-link text-light" style="text-decoration: none;">{% trans "Add my profile" %}</a></p>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <div class="col-12">
                    <a class="text-info" href="{% url 'profiles:list' %}">{% trans "Display all the profiles" %} ></a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid bg-light">
    <div class="row pt-5 pb-3 px-md-5 px-xl-0">
        <div class="col-xl-2 order-1">
        </div>
        <div class="col-xl-2 order-3">
        </div>
        <div class="col-xl-8 order-2">
            <div class="row">
                <div class="col-12 pb-3">
                    <h2>{% trans 'Last outings suggested' %}</h2>
                </div>
                {% for outing in 5_last_outings %}
                    <div class="col-sm-6 col-lg-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><a href="{{ outing.get_absolute_url }}" class="stretched-link">{{ outing.title }}</a></h5>
                                <p class="card-text">
                                    {% blocktrans with start_date=outing.start_date|date:"SHORT_DATE_FORMAT" end_date=outing.end_date|date:"SHORT_DATE_FORMAT" count duration=outing.duration %}
                                    During the day<br>{{ start_date }}
                                    {% plural %}
                                    {{ duration }} days<br>{{ start_date }} - {{ end_date }}
                                    {% endblocktrans %}
                                    <br>
                                    {% for activity in outing.activities.all %}
                                        <span class="badge badge-pill badge-info">{{ activity.name }}</span>
                                    {% endfor %}
                                </p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <div class="col-sm-6 col-lg-4 mb-4">
                    <div class="card bg-success" style="height: 100%;">
                        <div class="card-body d-flex align-items-center justify-content-center">
                            <p class="card-title text-uppercase align-middle mb-0 h4 text-center"><a href="{% url 'outings:create' %}" class="stretched-link text-light" style="text-decoration: none;">{% trans "Add my outing" %}</a></p>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <a class="text-info" href="{% url 'outings:create' %}">{% trans "Display all the outings" %} ></a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid bg-white">
    <div class="row pt-5 pb-3 px-md-5 px-xl-0">
        <div class="col-xl-2 order-1">
        </div>
        <div class="col-xl-2 order-3">
        </div>
        <div class="col-xl-8 order-2">
            <div class="row">
                <div class="col-12 pb-3">
                    <h2>{% trans 'Profiles map' %}</h2>
                </div>
                <div id="profilesmap" class="col-12" style="height: 550px;">
                    
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script>
    var pmap = L.map('profilesmap').locate({setView: true, maxZoom: 2});

    L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
        minZoom: 3,
        maxZoom: 16,
        attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
    }).addTo(pmap);

    {% for p in profiles %}
        L.marker([{{ p.location.y }}, {{ p.location.x }}]).bindPopup("<a href='{{ p.get_absolute_url }}'>test</a>").addTo(pmap);
    {% endfor %}

    var circle = L.circle([44.899416, 6.642179], {
        color: 'red',
        fillColor: '#f03',
        fillOpacity: 0.4,
        radius: 25000
    }).addTo(pmap);
    circle.bindPopup("Rayon de 25 km.");

    var popup = L.popup();
    function onMapClick(e) {
        popup
            .setLatLng(e.latlng)
            .setContent("You clicked the map at " + e.latlng.toString())
            .openOn(pmap);
    }
    pmap.on('click', onMapClick);

</script>
{% endblock %}